// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.
// See LICENSE in the project root for license information.
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/// <reference types='mocha' />
var chai_1 = require("chai");
var Npm_1 = require("../Npm");
var process = require("process");
var Utilities_1 = require("../Utilities");
var sinon = require("sinon");
describe('npm', function () {
    var packageName = '@microsoft/rush-lib-never';
    var stub;
    beforeEach(function () {
        stub = sinon.stub(Utilities_1.default, 'executeCommandAndCaptureOutput');
    });
    afterEach(function () {
        stub.restore();
    });
    it('publishedVersions gets versions when package time is available.', function () {
        var json = "{\n      \"modified\": \"2017-03-30T18:37:27.757Z\",\n      \"created\": \"2017-01-03T20:28:10.342Z\",\n      \"0.0.0\": \"2017-01-03T20:28:10.342Z\",\n      \"1.4.0\": \"2017-01-03T21:55:21.249Z\",\n      \"1.4.1\": \"2017-01-09T19:22:00.488Z\",\n      \"2.4.0-alpha.1\": \"2017-03-30T18:37:27.757Z\"\n    }";
        stub.withArgs('npm', ("view " + packageName + " time --json").split(' '), sinon.match.any, sinon.match.any)
            .returns(json);
        var versions = Npm_1.default.publishedVersions(packageName, __dirname, process.env);
        chai_1.assert.equal(versions.length, 4, 'Four versions of @microsoft/rush-lib-never should be found');
        chai_1.assert.includeMembers(versions, ['0.0.0', '1.4.0', '1.4.1', '2.4.0-alpha.1'], 'All versions match');
    });
    it('publishedVersions gets versions when package time is not available', function () {
        var json = "[\n      \"0.0.0\",\n      \"1.4.0\",\n      \"1.4.1\",\n      \"2.4.0-alpha.1\"\n    ]";
        stub.withArgs('npm', ("view " + packageName + " time --json").split(' '), sinon.match.any, sinon.match.any)
            .returns('');
        stub.withArgs('npm', ("view " + packageName + " versions --json").split(' '), sinon.match.any, sinon.match.any)
            .returns(json);
        var versions = Npm_1.default.publishedVersions(packageName, __dirname, process.env);
        chai_1.assert.equal(versions.length, 4, 'Four versions of @microsoft/rush-lib-never should be found');
        chai_1.assert.includeMembers(versions, ['0.0.0', '1.4.0', '1.4.1', '2.4.0-alpha.1'], 'All versions match');
    });
});

//# sourceMappingURL=Npm.test.js.map
