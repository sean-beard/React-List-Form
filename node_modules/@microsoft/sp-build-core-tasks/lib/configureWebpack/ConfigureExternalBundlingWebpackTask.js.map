{"version":3,"sources":["configureWebpack/ConfigureExternalBundlingWebpackTask.ts"],"names":[],"mappings":"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","file":"configureWebpack/ConfigureExternalBundlingWebpackTask.js","sourcesContent":["import * as lodash from 'lodash';\r\nimport * as Gulp from 'gulp';\r\nimport * as path from 'path';\r\nimport * as webpack from 'webpack';\r\nimport { WebpackTask } from '@microsoft/gulp-core-build-webpack';\r\n\r\nimport { getExternalsKeys } from './ExternalsProcessor';\r\nimport { IBundleEntry } from './ConfigureWebpackTask';\r\nimport OdspGulpTask, { IResolveResourcesResult } from './../OdspGulpTask';\r\nimport { ConfigureWebpackTask } from './ConfigureWebpackTask';\r\nimport { IWebpackStatsObject, externalsRegex } from './../copyAssets/CopyAssetsTask';\r\n\r\nexport interface IConfigureExternalBundlingWebpackTaskConfig {\r\n  webpack?: WebpackTask;\r\n  localizedResources?: string[];\r\n  configureWebpackTask?: ConfigureWebpackTask;\r\n  debugLocale?: string;\r\n  additionalLoaders?: webpack.Rule[];\r\n  bundleAllLocalizedResources?: boolean;\r\n}\r\n\r\n/**\r\n * Configures the @microsoft/gulp-core-build-webpack task to bundle localized externals into another, pre-built package.\r\n *\r\n * Example:\r\n *  IN:\r\n *    setConfig({\r\n *      webpack: <reference to webpack task>,\r\n *      localizedResources: <optional - list of localized externals>\r\n *      configureWebpackTask: <reference to the ConfigureWebpackTask task>,\r\n *      debugLocale: <optional - locale to use for a debug build>,\r\n *      additionalLoaders: <optional - additional loaders for localized resources>\r\n *    })\r\n *\r\n *  OUT:\r\n *    If any resources are specified and found, set webpack config to:\r\n *      {\r\n *        entry: <entries with locales>,\r\n *        module: {\r\n *          rules: ([\r\n *          ] <and additional loaders, if specified>,\r\n *          noParse: [ /\\.map$/ ],\r\n *        },\r\n *        resolve: {\r\n *          alias: <localized resources>,\r\n *          modulesDirectories: [\r\n *            '',\r\n *            'node_modules',\r\n *            'lib'\r\n *          ]\r\n *        },\r\n *        context: <dist directory>,\r\n *        devtool: 'source-map',\r\n *        externals: <externals and non-specified locales>,\r\n *        entry: webpackEntries,\r\n *        output: {\r\n *          libraryTarget: <library target from configureWebpackTask, if specified> or 'amd',\r\n *          path: this.outputDirectory\r\n *        },\r\n *        plugins: []\r\n *      }\r\n */\r\nexport class ConfigureExternalBundlingWebpackTask extends OdspGulpTask<IConfigureExternalBundlingWebpackTaskConfig> {\r\n  constructor() {\r\n    super(\r\n      'configure-webpack-external-bundling',\r\n      {\r\n        webpack: undefined,\r\n        localizedResources: undefined,\r\n        bundleAllLocalizedResources: false\r\n      }\r\n    );\r\n  }\r\n\r\n  public loadSchema(): Object {\r\n    return require('./configure-webpack-external-bundling.schema.json');\r\n  }\r\n\r\n  public setConfig(config: IConfigureExternalBundlingWebpackTaskConfig): void {\r\n    if (config.webpack && config.webpack.name !== 'webpack') {\r\n      this.logWarning('Setting webpack property to non-\"@microsoft/gulp-core-build-webpack\"-type will ' +\r\n                      'prevent configuration');\r\n    }\r\n\r\n    super.mergeConfig(config);\r\n  }\r\n\r\n  public executeTask(gulp: typeof Gulp, completeCallback: (error?: string) => void): NodeJS.ReadWriteStream {\r\n    if (!this.taskConfig.webpack) {\r\n      this.logWarning('\"webpack\" is not defined in the task configuration. Nothing to configure.');\r\n      completeCallback();\r\n      return;\r\n    }\r\n\r\n    if (!this.taskConfig.configureWebpackTask) {\r\n      this.logError('\"configureWebpackTask\" is not defined in the task configuration.');\r\n      this._setWebpackConfig(undefined);\r\n      completeCallback();\r\n      return;\r\n    }\r\n\r\n    if (!this._shouldBeEnabled) {\r\n      this.logVerbose('No localized resources specified, nothing to do.');\r\n      this._setWebpackConfig(undefined);\r\n      completeCallback();\r\n      return;\r\n    }\r\n\r\n    if (!this.properties.webpackStats) {\r\n      this.logError('Missing webpack stats object. Unable to configure.');\r\n      this._setWebpackConfig(undefined);\r\n      completeCallback();\r\n      return;\r\n    }\r\n\r\n    const resourcesToBundle: string[] = this._pruneLocalizedResources();\r\n    if (resourcesToBundle.length === 0) {\r\n      this.logVerbose('None of the specified localized resources were present in the webpack stats object. Nothing ' +\r\n                      'to do.');\r\n      this._setWebpackConfig(undefined);\r\n      completeCallback();\r\n      return;\r\n    }\r\n\r\n    // When we run webpack again, it'll overwrite this.properties.webpackStats, and we want to remember the\r\n    //  webpack stats object from the first webpack run.\r\n    this.properties.initialWebpackStats = this.properties.webpackStats;\r\n\r\n    let resolveResult: IResolveResourcesResult;\r\n    try {\r\n      resolveResult = this.resolveResources(resourcesToBundle, this.taskConfig.debugLocale, false);\r\n    } catch (error) {\r\n      completeCallback(error);\r\n      return;\r\n    }\r\n\r\n    const locales: string[] = resolveResult.locales;\r\n    const localizedResourcesToBundle: string[] = resolveResult.localizedResourcesToBundle;\r\n\r\n    const externalsKeys: string[] = getExternalsKeys(this);\r\n\r\n    const localizedResources: { [name: string]: string } = this.properties.localizedResources || {};\r\n    const localizedResourcesKeys: string[] = Object.keys(localizedResources).filter((key: string) => {\r\n      return localizedResourcesToBundle.indexOf(key) === -1;\r\n    });\r\n\r\n    if (!this.properties.bundledExternals) {\r\n      this.properties.bundledExternals = [];\r\n    }\r\n\r\n    this.properties.bundledExternals.push(...localizedResourcesToBundle);\r\n\r\n    const webpackEntries: { [name: string]: string } = this._generateWebpackEntries(locales);\r\n\r\n    const config: webpack.Configuration = {\r\n      module: {\r\n        rules: ([\r\n          {\r\n            use: require.resolve('source-map-loader'),\r\n            enforce: 'pre',\r\n            test: /\\.js$/\r\n          }\r\n        ] as webpack.Rule[]).concat(this.taskConfig.additionalLoaders || []),\r\n        noParse: [ /\\.map$/ ]\r\n      },\r\n      resolve: {\r\n        alias: {},\r\n        modules: [\r\n          'node_modules',\r\n          'lib'\r\n        ]\r\n      },\r\n      context: this.outputDirectory,\r\n      devtool: this.buildConfig.production ? undefined : 'source-map',\r\n      externals: externalsKeys.concat(localizedResourcesKeys),\r\n      entry: webpackEntries,\r\n      output: {\r\n        library: this.properties.webpackLibraryName,\r\n        libraryTarget: 'amd',\r\n        path: this.outputDirectory,\r\n        devtoolModuleFilenameTemplate: 'webpack:///../[resource-path]',\r\n        devtoolFallbackModuleFilenameTemplate: 'webpack:///../[resource-path]?[hash]'\r\n      }\r\n    };\r\n\r\n    // VSO#258841: Minification here doesn't make a big deal (<1kb gzipped), but adds a lot of build time.\r\n    //  This can updated eventually to drop a fake base bundle, run webpack, and then replace the fake bundle\r\n    //  with the real payload.\r\n    // if (this.buildConfig.production) {\r\n    //   config.plugins.push(new webpack.optimize.UglifyJsPlugin({\r\n    //     compress: {\r\n    //       dead_code: false,\r\n    //       warnings: false\r\n    //     },\r\n    //     mangle: true\r\n    //   }));\r\n    // }\r\n\r\n    this.taskConfig.configureWebpackTask.tinkerWithLocConfig(config);\r\n\r\n    const configs: webpack.Configuration[] = [];\r\n\r\n    for (const locale of locales) {\r\n      const localeWebpackConfig: webpack.Configuration = lodash.cloneDeep(config);\r\n\r\n      for (const resourceName of localizedResourcesToBundle) {\r\n        const resourcePath: string = this.properties.discoveredLocalizedResources[resourceName][locale];\r\n        localeWebpackConfig.resolve.alias[resourceName] = resourcePath;\r\n      }\r\n\r\n      localeWebpackConfig.output.filename = `[name]_${locale}.js`;\r\n      localeWebpackConfig.output.chunkFilename = `[id].[name]_${locale}_[chunkhash].js`;\r\n\r\n      configs.push(localeWebpackConfig);\r\n    }\r\n\r\n    this._setWebpackConfig(configs as webpack.Configuration);\r\n\r\n    completeCallback();\r\n  }\r\n\r\n  /**\r\n   * Modify the base webpack config to make sure we get what we need after that webpack instance runs.\r\n   *\r\n   * @internal\r\n   */\r\n  public tinkerWithBaseWebpackConfig(config: webpack.Configuration): void {\r\n    if (this._shouldBeEnabled) {\r\n      config.output.libraryTarget = 'amd';\r\n    }\r\n  }\r\n\r\n  private _generateWebpackEntries(locales: string[]): { [name: string]: string } {\r\n    const entries: IBundleEntry[] = this.properties.bundleEntries || [];\r\n\r\n    const webpackEntries: { [name: string]: string } = {};\r\n    entries.forEach((entry: IBundleEntry) => {\r\n      const entryName: string = path.basename(entry.nonLocalizedEntrypointPath, '.js');\r\n      webpackEntries[entryName] = path.join(this.outputDirectory, `${entryName}.js`);\r\n\r\n      entry.nonLocalizedEntrypointPath = undefined;\r\n      entry.localizedEntrypointPaths = {};\r\n      locales.forEach((locale: string) => {\r\n        entry.localizedEntrypointPaths[locale] = path.join(this.outputDirectory, `${entryName}_${locale}.js`);\r\n      });\r\n    });\r\n\r\n    return webpackEntries;\r\n  }\r\n\r\n  private _pruneLocalizedResources(): string[] {\r\n    const  { modules }: IWebpackStatsObject = this.properties.webpackStats.toJson({ modules: true });\r\n    const filteredResources: string[] = [];\r\n\r\n    for (const module of modules) {\r\n      const matches: string[] = module.name.match(externalsRegex);\r\n      if (matches) {\r\n        const externalName: string = matches[1];\r\n        if ((this.taskConfig.bundleAllLocalizedResources &&\r\n             this.properties.discoveredLocalizedResources[externalName]) ||\r\n            (this.taskConfig.localizedResources && this.taskConfig.localizedResources.indexOf(externalName) !== -1)) {\r\n          filteredResources.push(externalName);\r\n        }\r\n      }\r\n    }\r\n\r\n    return filteredResources;\r\n  }\r\n\r\n  private get _shouldBeEnabled(): boolean {\r\n    return this.taskConfig.configureWebpackTask &&\r\n           (this.taskConfig.bundleAllLocalizedResources &&\r\n            this.taskConfig.configureWebpackTask.properties.discoveredLocalizedResources &&\r\n            Object.keys(this.taskConfig.configureWebpackTask.properties.discoveredLocalizedResources).length !== 0) ||\r\n           (this.taskConfig.localizedResources &&\r\n            this.taskConfig.localizedResources.length !== 0);\r\n  }\r\n\r\n  private _setWebpackConfig(config: webpack.Configuration): void {\r\n    const webpackTask: WebpackTask = this.taskConfig.webpack;\r\n    if (webpackTask) {\r\n      if (!config) {\r\n        // We're just going to disable the second webpack task\r\n        webpackTask.isEnabled = () => false;\r\n      } else {\r\n        webpackTask.setConfig({\r\n          config: config as any, // tslint:disable-line:no-any\r\n          configPath: null // tslint:disable-line:no-null-keyword\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\src"}