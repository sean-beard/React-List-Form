"use strict";
/*
 * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.
 * See LICENSE in the project root for license information.
 */
Object.defineProperty(exports, "__esModule", { value: true });
/// <reference types="mocha" />
var chai_1 = require("chai");
var LoadThemedStylesLoader_1 = require("./../LoadThemedStylesLoader");
var LoadThemedStylesMock = require("./testData/LoadThemedStylesMock");
function wrapResult(loaderResult) {
    return "var module = { id: 'testId', exports: {} };\n  " + loaderResult + "\n  module;";
}
describe('LoadThemedStylesLoader', function () {
    beforeEach(function () {
        LoadThemedStylesLoader_1.LoadThemedStylesLoader.resetLoadedThemedStylesPath();
        LoadThemedStylesMock.loadedData = [];
        LoadThemedStylesMock.calledWithAsync = [];
    });
    it('follows the Webpack loader interface', function () {
        chai_1.assert.isDefined(LoadThemedStylesLoader_1.LoadThemedStylesLoader);
        chai_1.assert.isDefined(LoadThemedStylesLoader_1.LoadThemedStylesLoader.pitch);
        chai_1.assert.throws(function () { return new LoadThemedStylesLoader_1.LoadThemedStylesLoader(); });
    });
    it('it correctly resolves load-themed-styles', function () {
        var expectedPath = require.resolve('@microsoft/load-themed-styles');
        chai_1.assert.equal(LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath, expectedPath);
    });
    it('it inserts the resolved load-themed-styles path', function () {
        var expectedPath = require.resolve('@microsoft/load-themed-styles');
        var loaderResult = LoadThemedStylesLoader_1.LoadThemedStylesLoader.pitch.call({}, '');
        chai_1.assert.isNotNull(loaderResult.indexOf(expectedPath));
    });
    it('it allows for override of load-themed-styles path', function () {
        var expectedPath = './testData/LoadThemedStylesMock';
        LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath = expectedPath;
        chai_1.assert.equal(LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath, expectedPath);
        LoadThemedStylesLoader_1.LoadThemedStylesLoader.resetLoadedThemedStylesPath();
        expectedPath = require.resolve('@microsoft/load-themed-styles');
        chai_1.assert.equal(LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath, expectedPath);
    });
    it('it inserts the overridden load-themed-styles path', function () {
        var expectedPath = './testData/LoadThemedStylesMock';
        var loaderResult = LoadThemedStylesLoader_1.LoadThemedStylesLoader.pitch.call({}, '');
        chai_1.assert.isNotNull(loaderResult.indexOf(expectedPath));
    });
    it('correctly calls loadStyles in load-themed-styles with a module reference', function () {
        LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath = './testData/LoadThemedStylesMock';
        var loaderResult = LoadThemedStylesLoader_1.LoadThemedStylesLoader.pitch.call({}, './testData/MockStyle1');
        loaderResult = loaderResult.replace(/require\(\"!!/, 'require("');
        loaderResult = wrapResult(loaderResult);
        var returnedModule = eval(loaderResult); // tslint:disable-line:no-eval
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('STYLE 1') !== -1);
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('STYLE 2') !== -1);
        chai_1.assert.equal(LoadThemedStylesMock.loadedData.length, 2);
        chai_1.assert.isFalse(LoadThemedStylesMock.calledWithAsync[0]);
        chai_1.assert.isFalse(LoadThemedStylesMock.calledWithAsync[1]);
        chai_1.assert.equal(LoadThemedStylesMock.calledWithAsync.length, 2);
        chai_1.assert.equal(returnedModule.exports, 'locals');
    });
    it('correctly calls loadStyles in load-themed-styles with a string reference', function () {
        LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath = './testData/LoadThemedStylesMock';
        var loaderResult = LoadThemedStylesLoader_1.LoadThemedStylesLoader.pitch.call({}, './testData/MockStyle2');
        loaderResult = loaderResult.replace(/require\(\"!!/, 'require("');
        loaderResult = wrapResult(loaderResult);
        var returnedModule = eval(loaderResult); // tslint:disable-line:no-eval
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('styles') !== -1);
        chai_1.assert.equal(LoadThemedStylesMock.loadedData.length, 1);
        chai_1.assert.deepEqual(returnedModule.exports, {});
    });
    it('correctly handles the namedExport option', function () {
        LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath = './testData/LoadThemedStylesMock';
        var query = { namedExport: 'default' };
        var loaderResult = LoadThemedStylesLoader_1.LoadThemedStylesLoader.pitch.call({ query: query }, './testData/MockStyle1');
        loaderResult = loaderResult.replace(/require\(\"!!/, 'require("');
        loaderResult = wrapResult(loaderResult);
        var returnedModule = eval(loaderResult); // tslint:disable-line:no-eval
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('STYLE 1') !== -1);
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('STYLE 2') !== -1);
        chai_1.assert.equal(LoadThemedStylesMock.loadedData.length, 2);
        chai_1.assert.isFalse(LoadThemedStylesMock.calledWithAsync[0]);
        chai_1.assert.isFalse(LoadThemedStylesMock.calledWithAsync[1]);
        chai_1.assert.equal(LoadThemedStylesMock.calledWithAsync.length, 2);
        chai_1.assert.deepEqual(returnedModule.exports, { default: 'locals' });
    });
    it('correctly handles the async option set to "true"', function () {
        LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath = './testData/LoadThemedStylesMock';
        var query = { async: true };
        var loaderResult = LoadThemedStylesLoader_1.LoadThemedStylesLoader.pitch.call({ query: query }, './testData/MockStyle1');
        loaderResult = loaderResult.replace(/require\(\"!!/, 'require("');
        loaderResult = wrapResult(loaderResult);
        var returnedModule = eval(loaderResult); // tslint:disable-line:no-eval
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('STYLE 1') !== -1);
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('STYLE 2') !== -1);
        chai_1.assert.equal(LoadThemedStylesMock.loadedData.length, 2);
        chai_1.assert.isTrue(LoadThemedStylesMock.calledWithAsync[0]);
        chai_1.assert.isTrue(LoadThemedStylesMock.calledWithAsync[1]);
        chai_1.assert.equal(LoadThemedStylesMock.calledWithAsync.length, 2);
        chai_1.assert.equal(returnedModule.exports, 'locals');
    });
    it('correctly handles the async option set to a non-boolean', function () {
        LoadThemedStylesLoader_1.LoadThemedStylesLoader.loadedThemedStylesPath = './testData/LoadThemedStylesMock';
        var query = { async: 'asdf' };
        var loaderResult = LoadThemedStylesLoader_1.LoadThemedStylesLoader.pitch.call({}, './testData/MockStyle1');
        loaderResult = loaderResult.replace(/require\(\"!!/, 'require("');
        loaderResult = wrapResult(loaderResult);
        var returnedModule = eval(loaderResult); // tslint:disable-line:no-eval
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('STYLE 1') !== -1);
        chai_1.assert.isTrue(LoadThemedStylesMock.loadedData.indexOf('STYLE 2') !== -1);
        chai_1.assert.equal(LoadThemedStylesMock.loadedData.length, 2);
        chai_1.assert.isFalse(LoadThemedStylesMock.calledWithAsync[0]);
        chai_1.assert.isFalse(LoadThemedStylesMock.calledWithAsync[1]);
        chai_1.assert.equal(LoadThemedStylesMock.calledWithAsync.length, 2);
        chai_1.assert.equal(returnedModule.exports, 'locals');
    });
});

//# sourceMappingURL=LoadThemedStylesLoader.test.js.map
