"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var sp_core_library_1 = require("@microsoft/sp-core-library");
var SPThemeProvider_1 = require("./SPThemeProvider");
var SPGlobalErrorHandler_1 = require("../error/SPGlobalErrorHandler");
var DialogManagerConfiguration_1 = require("../extensibility/DialogManagerConfiguration");
var SPPageChrome_module_scss_1 = require("./SPPageChrome.module.scss");
var SPPageChrome = (function () {
    function SPPageChrome(serviceScope) {
        this._createPageChrome();
        DialogManagerConfiguration_1.default.instance.initialize(this.dialogContainerDiv);
        var guid = sp_core_library_1.Guid.parse('48CB5A9D-4E94-40F0-B51F-24480C28E565');
        if (!sp_core_library_1._SPKillSwitch.isActivated(guid, '7/13/2016', 'EnableTheming')) {
            this._spThemeProvider = new SPThemeProvider_1.default(serviceScope);
            this._spThemeProvider.loadThemedStyles();
        }
    }
    SPPageChrome.getInstance = function (serviceScope) {
        if (SPPageChrome._instance === undefined) {
            SPPageChrome._instance = new SPPageChrome(serviceScope);
        }
        return SPPageChrome._instance;
    };
    SPPageChrome.prototype.changeSuiteNavHeight = function (pixels) {
        var top = parseInt(pixels, 10) + 'px';
        if (!this._isFlexLayoutEnabled) {
            this.appDiv.style.top = top;
            this.appDiv.style.height = "calc(100% - " + top + ")";
            this.propertyPaneContainerDiv.style.top = top;
        }
        this.suiteNavDiv.style.height = top;
    };
    SPPageChrome.prototype._createPageChrome = function () {
        document.body.className = 'ms-font-m';
        var pageChromeDiv = document.createElement('div');
        pageChromeDiv.setAttribute('class', this._isFlexLayoutEnabled ? 'SPPageChrome' : 'SPPageChromeNoFlexbox');
        this.suiteNavDiv = document.createElement('div');
        this.suiteNavDiv.setAttribute('id', 'SuiteNavPlaceHolder');
        this.appDiv = document.createElement('div');
        this.appDiv.setAttribute('class', this._isFlexLayoutEnabled ? "SPPageChrome-app" : "SPPageChromeNoFlexbox-app " + SPPageChrome_module_scss_1.default.spPageContentTransition);
        this.appDiv.setAttribute('id', 'spPageChromeAppDiv');
        this.propertyPaneContainerDiv = document.createElement('div');
        if (this._isFlexLayoutEnabled) {
            this.propertyPaneContainerDiv.setAttribute('class', "spPropertyPaneContainer " + SPPageChrome_module_scss_1.default.spPageContentTransition);
            this.propertyPaneContainerDiv.setAttribute('id', 'spPropertyPaneContainer');
        }
        else {
            this.propertyPaneContainerDiv.setAttribute('class', "spPropertyPaneContainerNoFlexbox " + SPPageChrome_module_scss_1.default.spPageContentTransition);
            this.propertyPaneContainerDiv.setAttribute('id', 'spPropertyPaneContainerNoFlexbox');
        }
        pageChromeDiv.appendChild(this.suiteNavDiv);
        if (this._isFlexLayoutEnabled) {
            this.appAndPropertyPaneDiv = document.createElement('div');
            this.appAndPropertyPaneDiv.setAttribute('class', "spAppAndPropertyPanelContainer");
            pageChromeDiv.appendChild(this.appAndPropertyPaneDiv);
            this.appAndPropertyPaneDiv.appendChild(this.appDiv);
            this.appAndPropertyPaneDiv.appendChild(this.propertyPaneContainerDiv);
        }
        else {
            pageChromeDiv.appendChild(this.appDiv);
            pageChromeDiv.appendChild(this.propertyPaneContainerDiv);
        }
        this.dialogContainerDiv = document.createElement('div');
        this.dialogContainerDiv.setAttribute('id', 'spDialogContainerDiv');
        pageChromeDiv.appendChild(this.dialogContainerDiv);
        document.body.appendChild(pageChromeDiv);
        if (this._shouldHandleGlobalErrors && !window.onerror) {
            window.onerror = SPGlobalErrorHandler_1.default.basicTracingHandler;
        }
    };
    Object.defineProperty(SPPageChrome.prototype, "_shouldHandleGlobalErrors", {
        get: function () {
            return !sp_core_library_1._SPKillSwitch.isActivated(sp_core_library_1.Guid.parse('BAC66CD5-F1C1-4BDD-9FFD-A8C6044EB285'), '10/13/2016', 'GlobalErrorHandler');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SPPageChrome.prototype, "_isFlexLayoutEnabled", {
        get: function () {
            return !sp_core_library_1._SPKillSwitch.isActivated(sp_core_library_1.Guid.parse('E17AF313-E05B-4055-BDF7-7CD508F8853F'), '5/9/2017', 'Switch to flexbox');
        },
        enumerable: true,
        configurable: true
    });
    return SPPageChrome;
}());
exports.default = SPPageChrome;
