"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Validate_1 = require("../Validate");
var Text_1 = require("../Text");
var Log_1 = require("../log/Log");
var EventManager = (function () {
    function EventManager() {
        this._listeners = new Map();
    }
    Object.defineProperty(EventManager, "instance", {
        get: function () {
            if (!this._instance) {
                this._instance = new EventManager();
            }
            return this._instance;
        },
        enumerable: true,
        configurable: true
    });
    EventManager.prototype._raiseEvent = function (eventName, eventArgs) {
        var _this = this;
        Validate_1.default.isNonemptyString(eventName, 'eventName');
        Validate_1.default.isNotNullOrUndefined(eventArgs, 'eventArgs');
        if (!this._listeners.has(eventName)) {
            return;
        }
        this._listeners.get(eventName).forEach(function (listener) {
            if (listener.observer.isDisposed) {
                _this.unregisterEvent(eventName, listener.observer, listener.eventHandler);
            }
            else {
                try {
                    listener.eventHandler.apply(listener.observer, eventArgs);
                }
                catch (e) {
                    var errorMessage = Text_1.default.format(
                    'Failed to execute event handler for component "{0}"', listener.observer.componentId);
                    Log_1.default.error(EventManager._logSource, new Error(errorMessage));
                }
            }
        });
    };
    EventManager.prototype.registerEvent = function (eventName, observer, eventHandler) {
        Validate_1.default.isNonemptyString(eventName, 'eventName');
        Validate_1.default.isNotNullOrUndefined(observer, 'component');
        Validate_1.default.isNotNullOrUndefined(eventHandler, 'eventHandler');
        if (!this._listeners.has(eventName)) {
            this._listeners.set(eventName, []);
        }
        this._listeners.get(eventName).push({ observer: observer, eventHandler: eventHandler });
    };
    EventManager.prototype.unregisterEvent = function (eventName, observer, eventHandler) {
        Validate_1.default.isNonemptyString(eventName, 'eventName');
        Validate_1.default.isNotNullOrUndefined(observer, 'component');
        Validate_1.default.isNotNullOrUndefined(eventHandler, 'eventHandler');
        if (!this._listeners.has(eventName)) {
            return;
        }
        var filteredListeners = this._listeners.get(eventName).filter(function (el) { return el.observer !== observer || el.eventHandler !== eventHandler; });
        if (filteredListeners.length === this._listeners.get(eventName).length) {
            var errorMessage = Text_1.default.format(
            'Failed to remove event handler for component "{0}". Event handler was not registered.', observer.componentId);
            Log_1.default.error(EventManager._logSource, new Error(errorMessage));
        }
        this._listeners.set(eventName, filteredListeners);
    };
    EventManager._logSource = 'EventManager';
    return EventManager;
}());
exports.default = EventManager;
